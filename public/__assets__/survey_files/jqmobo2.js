var curField=null;var relationHT=new Array();var relationQs=new Object();var relationNotDisplayQ=new Object();function setCookie(b,d,a,f,c,e){document.cookie=b+"="+escape(d)+((a)?"; expires="+a:"")+((f)?"; path="+f:"")+((c)?"; domain="+c:"")+((e)?"; secure":"");}var spChars=["$","}","^","|","<"];var spToChars=["ξ","｝","ˆ","¦","&lt;"];var prevInputControl=null;function replace_specialChar(c){for(var a=0;a<spChars.length;a++){var b=new RegExp("(\\"+spChars[a]+")","g");c=c.replace(b,spToChars[a]);}if(/^[A-Za-z\s]+$/.test(c)){c=c.replace(/\s+/g," ");}c=c.replace(/[^\x09\x0A\x0D\x20-\uD7FF\uE000-\uFFFD\u10000-\u10FFFF]/ig,"");return $.trim(c);}String.prototype.format=function(){var a=arguments;return this.replace(/\{(\d+)\}/g,function(b,c){return a[c];});};var curfilediv=null;var isUploadingFile=false;var cur_page=0;var hasSkipPage=false;var prevControl=null;var pageHolder=null;var curMatrixFill=null;var curMatrixError=null;var imgVerify=null;var questionsObject=new Object();var allQArray=null;function setMatrixFill(){if(curMatrixError&&!curMatrixFill.fillvalue){return;}$("#divMatrixRel").hide();}function setChoice(a){$(a.parentNode).find("span").html(a.options[a.selectedIndex].text);$(a.parentNode).prev("input").val(a.value);}function showMatrixFill(f,c){if(c){if(curMatrixError){return;}curMatrixError=f;}curMatrixFill=f;var e=f.fillvalue||"";$("#matrixinput").val(e);var b=$(f).attr("req");var a="请注明...";var b=f.getAttribute("req");if(b){a="请注明...[必填]";}matrixinput.setAttribute("placeholder",a);var g=$(f).offset();var d=g.top-$(f).height()-15;$("#divMatrixRel").css("top",d+"px").css("left","0").show();}function refresh_validate(){if(imgCode&&tCode.style.display!="none"&&imgCode.style.display!="none"){imgCode.src="/AntiSpamImageGen.aspx?q="+activityId+"&t="+(new Date()).valueOf();}if(submit_text){submit_text.value="";}if(imgVerify){imgVerify.onclick();}}function processRadioInput(a,b){if(a.prevRadio&&a.prevRadio.itemText&&a.prevRadio!=b){a.prevRadio.itemText.pvalue=a.prevRadio.itemText.value;a.prevRadio.itemText.value="";}if(b.itemText&&b!=a.prevRadio){b.itemText.value=b.itemText.pvalue||"";}a.prevRadio=b;}function addClearHref(b){if(b.hasClearHref){b.clearHref.style.display="";return;}var a=document.createElement("a");a.title=validate_info_submit_title2;a.style.color="#999999";a.style.marginLeft="25px";a.innerHTML="["+type_radio_clear+"]";a.href="javascript:void(0);";b.hasClearHref=true;$(".field-label",b).append(a);b.clearHref=a;a.onclick=function(){clearFieldValue(b);referTitle(b);this.style.display="none";jumpAny(false,b);};}function referTitle(e,f){if(!e[0]._titleTopic){return;}var b="";if(f==undefined){$("input:checked",e).each(function(h){var g=$(this).parent().next().html();if(b){b+="&nbsp;";}b+=g;});}else{b=f;}for(var c=0;c<e[0]._titleTopic.length;c++){var a=e[0]._titleTopic[c];var d=document.getElementById("spanTitleTopic"+a);if(d){d.innerHTML=b;}}}function showImg(b){var a=$(b).attr("tpiao");if(!a){return;}$("img",b).bind("click",function(f){var d=this.parentNode.getAttribute("pimg");if(!d){return;}var c=document.createElement("img");c.onload=function(){var g=document.getElementById("divImgPop");if(!g){$("body").append("<div id='divImgPop' style='display:none;'></div>");g=document.getElementById("divImgPop");}var m=this.width;var k=this.height;var j=$(window).width();var l=$(window).height();var h,e;var n=0.9;if(k>l*n){e=l*n;h=e/k*m;if(h>j*n){h=j*n;}}else{if(m>j*n){h=j*n;e=h/m*k;}else{h=m;e=k;}}g.innerHTML="<img src='"+d+"' style='width:"+h+"px' alt=''/>";openDialogByIframe(h,e,"divImgPop");};c.src=d;f.preventDefault();f.stopPropagation();return false;});}$(function(){pageHolder=$("fieldset.fieldset");for(var w=0;w<pageHolder.length;w++){var B=$(pageHolder[w]).attr("skip")=="true";if(B){pageHolder[w].skipPage=true;hasSkipPage=true;}var a=$(".field",pageHolder[w]);pageHolder[w].questions=a;var s=0;for(var x=0;x<a.length;x++){a[x].indexInPage=s;if(hasSkipPage){a[x].pageParent=pageHolder[w];}s++;}}$("#divMatrixRel").bind("click",function(k){k.stopPropagation();});$(document).bind("click",function(){setMatrixFill();postHeight();});$("#matrixinput").on("keyup blur focus",function(){if(curMatrixFill){var k=$("#matrixinput").val();curMatrixFill.fillvalue=k;}});var b=false;var A=new Array();allQArray=$(".field");allQArray.each(function(){var M=$(this);M.bind("click",function(){if(this.removeError){this.removeError();}if(window.scrollup){scrollup.Stop();}});var q=M.attr("type");var S=getTopic(M);questionsObject[S]=M;var I=M.attr("relation");if(I&&I!="0"){var F=I.split(",");var W=F[0];var P=F[1].split(";");for(var K=0;K<P.length;K++){var G=W+","+P[K];if(!relationHT[G]){relationHT[G]=new Array();}relationHT[G].push(this);}if(!relationQs[W]){relationQs[W]=new Array();}relationQs[W].push(this);relationNotDisplayQ[S]="1";}else{if(I=="0"){relationNotDisplayQ[S]="1";}}var N=M.attr("titletopic");if(N){var U=questionsObject[N];if(U){if(!U[0]._titleTopic){U[0]._titleTopic=new Array();}U[0]._titleTopic.push(S);var L=M.find(".field-label")[0];if(L){L.innerHTML=L.innerHTML.replace("[q"+N+"]","<span id='spanTitleTopic"+S+"' style='text-decoration:underline;'></span>");}}}if(M.attr("hrq")=="1"){return true;}if(q=="1"){var Q=$("input",M);Q.on("keyup blur click",function(){verifyTxt(M,Q);prevInputControl=this;window.hasAnswer=true;jump(M,this);referTitle(M,this.value);});Q.focus(function(){});Q.blur(function(){checkOnly(M,Q);});var O=$("textarea",M);if(O[0]){var k=O.prev("a")[0];k.par=M[0];O[0].par=M[0];M[0].needsms=true;var V=O.parent().find(".phonemsg")[0];M[0].mobileinput=Q[0];M[0].verifycodeinput=O[0];k.onclick=function(){if(this.disabled){return;}var aa=this.par;if(aa.issmsvalid&&aa.mobile==aa.mobileinput.value){return;}if(this.isSending){return;}this.isSending=true;this.disabled=true;var Z="/Handler/AnswerSmsHandler.ashx?q="+activityId+"&mob="+escape(aa.mobileinput.value)+"&t="+(new Date()).valueOf();$.ajax({type:"GET",url:Z,async:false,success:function(ac){var ad="";if(ac=="true"){ad="成功发送验证码，每天最多发送5次。如未收到，请检查手机号码是否输入正确！";}else{if(ac=="fast"){ad="发送频率过快";}else{if(ac=="many"){ad="发送验证码次数过多";}else{if(ac=="no"){ad="发布者短信数量不够";}else{if(ac=="fail"){ad="短信发送失败，每天最多发送5次！";}else{if(ac=="error"){ad="手机号码不正确";}else{if(ac=="nopub"){ad="问卷还未发布";}}}}}}}V.innerHTML=ad;this.isSending=false;}});var Y=this;var X=60;var ab=setInterval(function(){X--;if(X<57){Y.isSending=false;}if(X>0){Y.innerHTML="重新发送("+X+")";}else{Y.innerHTML="发送验证短信";Y.disabled=false;clearInterval(ab);}},1000);};O[0].onchange=O[0].onblur=function(){var Z=this.value;if(Z.length!=6){V.innerHTML="提示：请输入6位数字！";return;}if(!/^\d+$/.exec(Z)){V.innerHTML="提示：请输入6位数字！";return;}var Y=this.par;if(Y.issmsvalid&&Y.mobile==Y.mobileinput.value){return;}if(Y.prevcode==Z){return;}Y.prevcode=Z;var X="/Handler/AnswerSmsValidateHandler.ashx?q="+activityId+"&mob="+escape(Y.mobileinput.value)+"&code="+escape(Z)+"&t="+(new Date()).valueOf();$.ajax({type:"GET",url:X,async:false,success:function(aa){Y.issmsvalid=false;var ab="";if(aa=="true"){Y.issmsvalid=true;Y.mobile=Y.mobileinput.value;ab="成功通过验证";writeError(Y,"",1000);}else{if(aa=="send"){ab="请先发送验证码，每天最多发送5次！";}else{if(aa=="no"){ab="验证码输入错误超过5次，无法再提交";}else{if(aa=="error"){ab="验证码输入错误";}}}}V.innerHTML=ab;}});};}}else{if(q=="2"){var Q=$("textarea",M);Q.on("keyup blur click",function(){verifyTxt(M,Q);prevInputControl=this;window.hasAnswer=true;jump(M,this);referTitle(M,this.value);});Q.blur(function(){checkOnly(M,Q);});}else{if(q=="9"){$("input",M).on("keyup blur",function(){var X=$(this);prevInputControl=this;msg=verifyTxt(M,$(this),true);jump(M,this);});}else{if(q=="8"){$("input",M).change(function(){jump(M,this);});}else{if(q=="12"){$("input",M).change(function(){var Y=null;var ab=$(M).attr("total");var ac=$("input:visible",M);var Z=count=ac.length;var ad=ab;ac.each(function(ae){if(ae==Z-1){Y=this;}if($(this).val()){count--;ad=ad-$(this).val();}});if(count==1&&Y&&ad>0){$(Y).val(ad).change();ad=0;}msg="";if(ad!=0&&count==0){var aa=parseInt($(Y).val())+ad;if(aa>=0){if(Y!=this){$(Y).val(aa).change();ad=0;}else{if(ac.length==2){var X=ab-$(Y).val();$(ac[0]).val(X).change();ad=0;}}}else{msg="，<span style='color:red;'>"+sum_warn+"</span>";}}if(ad==0){ac.each(function(ae){if(!$(this).val()){$(this).val("0").change();}});}$(".relsum",M).html(sum_total+"<b>"+ab+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+(ab-ad)+"</span>"+msg);jump(M,this);});}else{if(q=="13"){b=true;}else{if(q=="3"){var J=$("div.ui-radio",M);J.each(function(){showImg(this);});J.bind("click",function(aa){var Y=$(this);var Z=Y.find("input[type='radio']")[0];if(Z.disabled){return;}window.hasAnswer=true;$(M).find("div.ui-radio").each(function(){var ab=$(this);ab.find("input[type='radio']")[0].checked=false;ab.find("a.jqradio").removeClass("jqchecked");});Z.checked=true;var X=Y.find("input.OtherRadioText")[0];if(X){Z.itemText=X;}processRadioInput(M[0],Z);Y.find("a.jqradio").addClass("jqchecked");displayRelationByType(M,"input[type=radio]",1);referTitle(M);jump(M,Z);if(M.attr("req")!="1"){addClearHref(M);}if(Y.attr("desc")!=1){aa.preventDefault();}});var T=M.attr("qingjing");if(T){A.push(M);}$("input.OtherRadioText",M).bind("click",function(ab){$(this.parentNode.parentNode.parentNode).find("div.ui-radio").each(function(){$(this).find("input[type='radio']")[0].checked=false;$(this).find("a.jqradio").removeClass("jqchecked");});prevInputControl=this;var X=$(this).attr("rel");var Z=$("#"+X)[0];Z.checked=true;var Y=$("#"+X).parent().parent();Y.find("a.jqradio").addClass("jqchecked");Z.itemText=this;var aa=$(this).parents("div.field");processRadioInput(aa[0],Z);displayRelationByType(aa,"input[type=radio]",1);jump(aa,Z);ab.stopPropagation();ab.preventDefault();});}else{if(q=="7"){var H=$("select",M);H.bind("change",function(Y){$("span",this.parentNode).html(this.options[this.selectedIndex].text);displayRelationByType(M,"option",5);jump(M,this.options[this.selectedIndex]);var X=this.options[this.selectedIndex].text;if(this.value==-2){X="";}referTitle(M,X);Y.preventDefault();});if(H[0].selectedIndex>0){$("span",H[0].parentNode).html(H[0].options[H[0].selectedIndex].text);}}else{if(q=="10"){var R=M.attr("select")=="1";if(R){$("select",M).bind("change",function(){$("span",this.parentNode).html(this.options[this.selectedIndex].text);jump(M,this);});}$("input",M).bind("change blur",function(){var ac=$(this);var ab=ac.val();prevInputControl=this;var Y=ac.attr("isdigit");var aa=Y=="1"||Y=="2";if(aa){if(Y=="1"&&parseInt(ab)!=ab){ac.val("");}else{if(Y=="2"&&parseFloat(ab)!=ab){ac.val("");}else{var Z=ac.attr("min");if(Z&&ab-Z<0){ac.val("");}var X=ac.attr("max");if(X&&ab-X>0){ac.val("");}}}}else{msg=verifyTxt(M,$(this),true);}jump(M,this);});}else{if(q=="5"){initRate(M);}else{if(q=="6"){initRate(M);}else{if(q=="4"){var E=$("div.ui-checkbox",M);E.each(function(){showImg(this);});E.bind("click",function(Z){var aa=$(this);var Y=aa.find("input[type='checkbox']")[0];if(Y.disabled){return;}Y.checked=!Y.checked;window.hasAnswer=true;if(Y.checked){aa.find("a.jqcheck").addClass("jqchecked");}else{aa.find("a.jqcheck").removeClass("jqchecked");}checkHuChi(M,this);displayRelationByType(M,"input[type='checkbox']",2);verifyCheckMinMax(M,false,false,this);jump(M,Y);if(window.createItem){createItem(M);}var X=aa.find("input.OtherText")[0];if(X){if(!Y.checked){X.pvalue=X.value;X.value="";}else{X.value=X.pvalue||"";}}referTitle(M);Z.preventDefault();});$("input.OtherText",M).bind("click",function(ac){var Y=$(this).attr("rel");var Z=$("#"+Y)[0];prevInputControl=this;var ab=$(this).parents("div.field");var X=ab.attr("maxvalue");if(X){var ad=$("input:checked",ab).length;if(ad>X||(ad==X&&!Z.checked)){$(this).blur();ac.stopPropagation();ac.preventDefault();return;}}Z.checked=true;Z.itemText=this;var aa=$("#"+Y).parent().parent();aa.find("a.jqcheck").addClass("jqchecked");if(this.pvalue&&!this.value){this.value=this.pvalue;}checkHuChi(ab,aa[0]);displayRelationByType(ab,"input[type=checkbox]",2);jump(ab,Z);verifyCheckMinMax(ab,false);if(window.createItem){createItem(ab);}ac.stopPropagation();ac.preventDefault();});}else{if(q=="21"){$(".shop-item",M).each(function(){var X=$(".itemnum",this);var Y=$(".item_left",this);$(".add",this).bind("click",function(aa){var ad=false;var Z=0;if(Y[0]){ad=true;Z=parseInt(Y.attr("num"));}var ac=parseInt(X.val());if(ad&&ac>=Z){var ab="库存只剩"+Z+"件，不能再增加！";if(Z<=0){ab="已售完，无法添加";}alert(ab);}else{X.val(ac+1);updateCart();}aa.preventDefault();});X.bind("focus",function(Z){if(X.val()=="0"){X.val("");}});X.bind("blur change",function(ab){if(!X.val()){X.val("0");}var ae=parseInt(X.val());if(!ae||ae<0){X.val("0");updateCart();return;}var ad=false;var aa=0;if(Y[0]){ad=true;aa=parseInt(Y.attr("num"));}if(ad){if(ae>aa){var ac="库存只剩"+aa+"件，不能超过库存！";if(aa<=0){ac="已售完，无法添加";}alert(ac);var Z=aa;if(Z<0){Z=0;}X.val(Z);}}updateCart();ab.preventDefault();});$(".remove",this).bind("click",function(Z){var aa=parseInt(X.val());if(aa>0){X.val(aa-1);updateCart();}Z.preventDefault();});});}else{if(q=="11"){$("li.ui-li-static",M).bind("click",function(Y){if(!$(this).attr("check")){var X=$(this.parentNode).find("li[check='1']").length+1;$(this).find("span.sortnum").html(X).addClass("sortnum-sel");$(this).attr("check","1");}else{var X=$(this).find("span").html();$(this.parentNode).find("li[check='1']").each(function(){var Z=$(this).find("span.sortnum").html();if(Z-X>0){$(this).find("span.sortnum").html(Z-1);}});$(this).find("span.sortnum").html("").removeClass("sortnum-sel");$(this).attr("check","");}displayRelationByType(M,"li.ui-li-static",3);verifyCheckMinMax(M,false,true,this);jump(M,this);if(window.createItem){createItem(M,true);}Y.preventDefault();});}}}}}}}}}}}}}}});if(window.totalCut&&window.totalCut>0){for(var x=0;x<window.totalCut;x++){var g="divCut"+(x+1);var C=$("#"+g);var h=C.attr("relation");if(h&&h!="0"){var d=h.split(",");var D=d[0];var p=d[1].split(";");for(var l=0;l<p.length;l++){var e=D+","+p[l];if(!relationHT[e]){relationHT[e]=new Array();}relationHT[e].push(C[0]);}if(!relationQs[D]){relationQs[D]=new Array();}relationQs[D].push(C[0]);}var o=C.attr("titletopic");if(o){var y=questionsObject[o];if(y){if(!y[0]._titleTopic){y[0]._titleTopic=new Array();}var v=C.attr("topic");y[0]._titleTopic.push(v);var m=C[0].childNodes[0];if(m){m.innerHTML=m.innerHTML.replace("[q"+o+"]","<span id='spanTitleTopic"+v+"' style='text-decoration:underline;'></span>");}}}}}for(var u=0;u<pageHolder.length;u++){var a=pageHolder[u].questions;for(var x=0;x<a.length;x++){var v=getTopic(a);if(relationQs[v]){relationJoin(a[x]);}}}for(var f=0;f<A.length;f++){var n=A[f];displayRelationByType(n,"input[type=radio]",1);}$("#ctlNext")!=null&&$("#ctlNext").on("click",function(){if(this.disabled){return;}if(window.divTip){alert(divTip.innerHTML);return;}$("#action").val("1");var k=validate();if(!k){return;}if(window.isDianChu){if(!is_dianchecked){$(".ValError").html("请按提示点击验证码");tou_submit.call(this);return;}}else{if(tCode&&tCode.style.display!="none"&&(submit_text.value==""||submit_text.value==validate_info_submit_title3)){try{submit_text.focus();submit_text.click();}catch(q){}alert(validate_info_submit1);return;}}groupAnswer(1);});setVerifyCode();initSlider();if(totalPage>1){$("#divSubmit").hide();$("#divNext")[0].style.display="";showProgress();}else{$("#divSubmit").show();}if(window.hasPageTime){if(!window.divFengMian){processMinMax();}}fixBottom();$(window).load(function(){fixBottom();});if(window.cepingCandidate){var r=cepingCandidate.split(",");var t=new Object();for(var z=0;z<r.length;z++){var c=r[z].replace(/(\s*)/g,"").replace(/&/g,"");t[c]="1";}var j=$("#div1");$("input[type=checkbox]",j).each(function(){var E=$(this).parent().parent();var q=E.find(".label")[0];if(!q){return true;}var k=q.innerHTML;k=k.replace(/(\s*)/g,"").replace(/&amp;/g,"");if(t[k]){this.checked=true;}});if(j[0]){createItem(j,false);j[0].style.display="none";j[0].isCepingQ="1";}}processAward();});function hideAward(){if(!confirm("确认不再领取吗？")){return;}if(window.localStorage){vkey="award_"+activityId;localStorage.removeItem(vkey);localStorage.removeItem(vkey+"name");localStorage.removeItem(vkey+"tip");}$("#divContent").show().prev().hide();initSlider();}function processAward(){var b="join_"+activityId;if(!document.cookie||document.cookie.indexOf(b+"=")==-1){return;}b="award_"+activityId;var d="";var a="";if(window.localStorage){d=localStorage[b];a=localStorage[b+"name"];}if(d&&d.indexOf("http")==0){var c=localStorage[b+"tip"];var f="";if(c){f=" onclick='alert(\""+c+"\");return true;' ";}var e="<div style='margin:10px 12px;'>恭喜您抽中了"+a+"，如已领取请忽略！<br/><div style='text-align:center;'><a href='"+d+"'"+f+" class='button white' target='_blank' style='color:#fff; background:#e87814;'>立即领取</a></div><div style='margin-top:18px;text-align:center;'><a href='javascript:' onclick='hideAward();' style='color:#666;font-size:14px;'>不领取，重新填写问卷</a></div></div>";$("#divContent").before(e);$("#divContent").hide();}}function postHeight(){if(window==window.top){return;}try{var c=parent.postMessage?parent:parent.document.postMessage?parent.document:null;if(c!=null){var a=$("body").height();return c.postMessage("heightChanged,"+a,"*");}}catch(b){}}function initRate(a){$(".rate-off",a).parent().bind("click",function(k){var b=$(a).attr("ischeck");var c=$("a",this)[0];if(b){var g=true;var n=$(a).attr("maxvalue");if(n&&!$(c).hasClass("rate-on")){var m=$("a.rate-on",this.parentNode);if(n-m.length<=0){g=false;}}if(g){$(c).toggleClass("rate-on");$(c).toggleClass("rate-onchk");$(c).trigger("change");}}else{var f=$(this.parentNode).find("a.rate-off");f.removeClass("rate-on");var j=$(c).attr("mode");if(j){f.removeClass("rate-on"+j);var l=c;f.each(function(){$(this).toggleClass("rate-on");$(this).toggleClass("rate-on"+j);if(this==l){return false;}});}else{$(c).toggleClass("rate-on");if(!$(c).text()){f.removeClass("rate-ontxt");$(c).toggleClass("rate-ontxt");}}$(c).trigger("change");}if($(c).hasClass("rate-on")){var j=$(c).attr("mode");if(!j){var h=$(c).attr("needfill");if(h){showMatrixFill(c);k.stopPropagation();}}}if(a.attr("type")=="5"){displayRelationByType(a,"a.rate-off",4);}jump(a,c);if(a.attr("req")!="1"){addClearHref(a);}$("span.error",a).is(":visible")&&validateQ(a);k.preventDefault();});}function updateCart(){var d=$("#divQuestion");var b="";var c=0;var a=0;$(".shop-item",d).each(function(){var f=$(".itemnum",this);var j=parseInt(f.val());if(j==0){return true;}var k=$(".item_name",this).html();var g=$(".item_price",this).attr("price");var h=j*parseFloat(g).toFixed(2);var e='<li class="productitem"><span class="fpname">'+k+'</span><span class="fpnum">'+j+'</span><span class="fpprice">￥'+h+"</span></li>";b+=e;c+=h;a+=j;});b="<ul class='productslist'>"+b+'<li class="productitem"><span class="fpname"></span><span class="fpnum" style="font-weight:bold;">'+a+'</span><span class="fpprice" style="font-weight:bold;">￥'+c.toFixed(2)+"</span></li></ul>";$("#shopcart").html(b);if(c>0){$("#shopcart").show();}else{$("#shopcart").hide();}}function setVerifyCode(){if(tCode&&tCode.style.display!="none"){submit_text.value=validate_info_submit_title3;submit_text.onblur=function(){if(submit_text.value==""){submit_text.value=validate_info_submit_title3;}};submit_text.onfocus=function(){if(submit_text.value==validate_info_submit_title3){submit_text.value="";}};imgCode.style.display="none";if(window.isDianChu){tCode.style.display="none";return;}submit_text.onclick=function(){if(!needAvoidCrack&&imgCode.style.display=="none"){imgCode.style.display="";imgCode.onclick=refresh_validate;imgCode.onclick();imgCode.title=validate_info_submit_title1;}else{if(needAvoidCrack&&!imgVerify){var c=$("#divCaptcha")[0];c.style.display="";imgVerify=c.getElementsByTagName("img")[0];imgVerify.style.cursor="pointer";imgVerify.onclick=function(){var h=new Date();var e=h.getTime()+(h.getTimezoneOffset()*60000);var f=window.location.host||"www.sojump.com";var g="//"+f+"/BotDetectCaptcha.ashx?activity="+activityId+"&get=image&c="+this.captchaId+"&t="+this.instanceId+"&d="+e;this.src=g;};var a=imgVerify.getAttribute("captchaid");var b=imgVerify.getAttribute("instanceid");imgVerify.captchaId=a;imgVerify.instanceId=b;imgVerify.onclick();}}};}}function fixBottom(){postHeight();var a=$("body").height()-$(window).height();if(a<0){$(".logofooter").addClass("fixedbottom");}else{$(".logofooter").removeClass("fixedbottom");}}var firstError=null;var firstMatrixError=null;var needSubmitNotValid=false;function validate(){var b=true;firstError=null;firstMatrixError=null;curMatrixError=null;$(".field:visible").each(function(){var e=pageHolder[cur_page].hasExceedTime;if(e){return true;}var d=$(this),a=validateQ(d);if(!a){b=false;}});if(!b){if(firstError){$("html, body").animate({scrollTop:$(firstError).offset().top},600);$(".scrolltop").show();$(".scrolltop").click(function(){$("html, body").animate({scrollTop:$(document).height()},600);$(".scrolltop").hide();});}}else{}return b;}var txtCurCity=null;function openCityBox(f,e,c,g){txtCurCity=f;var d="";g=g||"";if(e==3){var a=f.getAttribute("province");var b="";if(a){b="&pv="+encodeURIComponent(a);}d="/wjx/design/setcitycountymobo2.aspx?activityid="+activityId+"&ct="+e+b+"&pos="+g;}else{if(e==4){d="/wjx/design/school.aspx?activityid="+activityId+"&ct="+e+b+"&pos="+g;}else{if(e==5){d="/wjx/design/setmenusel.aspx?activityid="+activityId+"&ct="+e+"&pos="+g;}else{if(e==6){d="/wjx/join/amap.aspx?activityid="+activityId+"&ct="+e+"&pos="+g;if($(f).attr("needonly")=="1"){d+="&nc=1";if(f.value){$(f.parentNode.parentNode).find(".errorMessage").html("提示：定位后无法修改。");return;}}}else{d="/wjx/design/setcitymobo2.aspx?activityid="+activityId+"&ct="+e+"&pos="+g;}}}}openDialogByIframe(400,400,d);}function showItemDesc(b,a,d){var c=$.trim(document.getElementById(d).innerHTML);if(c.indexOf("http")==0){openDialogByIframe(b,a,c,true);}else{openDialogByIframe(b,a,d);}}function setCityBox(a){txtCurCity.value=a;$("#yz_popTanChuClose").click();}var startAge=0;var endAge=0;var rName="";function getRname(c,b){if(rName){return;}if(c!="1"){return;}var d=$("div.field-label",b).html();if(d.indexOf("姓名")==-1){return;}rName=$("input:text",b).val();}function getAge(c,b){if(c!="3"&&c!="7"){return;}var h=$("div.field-label",b).html();if(h.indexOf("年龄")==-1){return;}var e="";var g=0;if(c==3){$("input[type='radio']",b).each(function(a){if(this.checked){e=$(this.parentNode.parentNode).find(".label").html();g=a;return false;}});}else{if(c==7){var d=$("select",b)[0];e=d.options[d.selectedIndex].text;g=d.selectedIndex-1;}}if(!e){return;}var f=/[1-9][0-9]*/g;var j=e.match(f);if(!j||j.length==0){return;}if(j.length>2){return;}if(j.length==2){startAge=j[0];endAge=j[1];}else{if(j.length==1){if(g==0){endAge=j[0];}else{startAge=j[0];}}}}function groupAnswer(l){var f=new Array();var k=0;allQArray.each(function(){var v=$(this);var E=new Object();var A=v.attr("type");var w=this.style.display!="none";if(w&&hasSkipPage){if(this.pageParent&&this.pageParent.skipPage){w=false;}}if(this.isCepingQ){w=true;}E._value="";E._topic=getTopic(v);f[k++]=E;try{getAge(A,v);getRname(A,v);}catch(y){}var B=0;switch(A){case"1":if(!w){E._value="(跳过)";if(v.attr("hrq")=="1"){E._value="Ⅳ";}break;}var t=$("input",v);var r=t.val();if(r&&t[0].lnglat){r=r+"["+t[0].lnglat+"]";}E._value=replace_specialChar(r);break;case"2":if(!w){E._value="(跳过)";if(v.attr("hrq")=="1"){E._value="Ⅳ";}break;}var t=$("textarea",v);var r=t.val();if(r&&t[0].lnglat){r=r+"["+t[0].lnglat+"]";}E._value=replace_specialChar(r);break;case"3":if(!w){E._value="-3";if(v.attr("hrq")=="1"){E._value="-4";}break;}$("input[type='radio']:checked",v).each(function(G){E._value=$(this).val();var F=$(this).attr("rel");if(F&&$("#"+F).val().length>0){E._value+=spChars[2]+replace_specialChar($("#"+F).val().substring(0,3000));}return false;});break;case"4":if(!w){E._value="-3";if(v.attr("hrq")=="1"){E._value="-4";}break;}var z=0;$("input:checked",v).each(function(){var G=this.parentNode.parentNode.style.display=="none";if(!G){if(z>0){E._value+=spChars[3];}E._value+=$(this).val();var F=$(this).attr("rel");if(F&&$("#"+F).val().length>0){E._value+=spChars[2]+replace_specialChar($("#"+F).val().substring(0,3000));}z++;}});if(z==0){E._value="-2";}break;case"21":if(!w){E._value="-3";break;}var z=0;$(".shop-item .itemnum",v).each(function(F){var G=$(this).val();if(G!="0"){if(z>0){E._value+=spChars[3];}E._value+=(F+1);E._value+=spChars[2]+G;z++;}});if(z==0){E._value="-2";}break;case"11":var s=new Array();$("li.ui-li-static",v).each(function(){var F=$(this).find("span.sortnum").html();var G=new Object();G.sIndex=F;var H=$(this).find("input:hidden").val();if(!w){H="-3";}else{if(!F){H="-2";}}G.val=H;if(!G.sIndex){G.sIndex=10000;}s.push(G);});s.sort(function(G,F){return G.sIndex-F.sIndex;});for(var u=0;u<s.length;u++){if(u>0){E._value+=",";}E._value+=s[u].val;}break;case"5":if(!w){E._value="-3";break;}E._value=$("input:hidden",v).val();break;case"6":B=0;$("input:hidden",v).each(function(F){if(B>0){E._value+=",";}var G=false;var H=(F+1);if(window.hasReferClient){var I=document.getElementById("drv"+E._topic+"_"+(F+1));if(I&&I.style.display=="none"){G=true;}else{if(!I&&questionsObject[E._topic]){G=true;}}}E._value+=H+spChars[4];if(!w){E._value+="-3";}else{var J=$(this).val();if(!J){J="-2";}if(G){J="-4";}E._value+=J;}B++;});break;case"7":if(!w){E._value="-3";break;}E._value=$("select",v).val();break;case"8":if(!w){E._value="(跳过)";break;}E._value=$("input.ui-slider-input",v).val();break;case"9":B=0;if(!w&&v.attr("hrq")=="1"){E._value="Ⅳ";break;}var C=$("input",v);if(v.attr("randomrow")=="1"){var x=v.attr("topic");C=C.toArray().sort(function(H,G){var F=$(H).attr("id").replace("q"+x+"_","");var I=$(G).attr("id").replace("q"+x+"_","");return F-I;});}$(C).each(function(){if(B>0){E._value+=spChars[2];}var G=this.getAttribute("rowid");if(G){E._value+=G+spChars[4];}var I=$(this).val();var F=false;if(window.hasReferClient){var H=this.parentNode.parentNode.parentNode;if(H&&H.tagName=="TR"&&H.style.display=="none"){F=true;}}if(!w){I="(跳过)";}else{if(F){I="Ⅳ";}}if(I&&this.lnglat){I=I+"["+this.lnglat+"]";}E._value+=replace_specialChar(I);B++;});break;case"12":B=0;$("input",v).each(function(){if(B>0){E._value+=spChars[2];}var F=false;if(window.hasReferClient){var I=this.parentNode.parentNode.parentNode;if(I&&I.style.display=="none"){F=true;}}var G=this.getAttribute("rowid");if(G){E._value+=G+spChars[4];}var H=$(this).val();if(!w){H="(跳过)";}else{if(F){H="Ⅳ";}}E._value+=H;B++;});break;case"13":if(!w){E._value="(跳过)";break;}E._value=this.fileName||"";break;case"10":B=0;var D="input";var e="(跳过)";if(v.attr("select")=="1"){D="select";e="-3";}$("table",v).each(function(){var J=this;if(B>0){E._value+=spChars[2];}var F=0;var G=false;if(window.hasReferClient){var I=J.parentNode;if(I&&I.style.display=="none"){G=true;}}var H=J.parentNode.getAttribute("rowid");if(H){E._value+=H+spChars[4];}$(D,this).each(function(){if(F>0){E._value+=spChars[3];}var K=this;var L=K.value;if(!w){L=e;}else{if(G){L="Ⅳ";}}if(L&&K.lnglat){L=L+"["+K.lnglat+"]";}E._value+=replace_specialChar(L);F++;});B++;});break;}});if(f.length==0){alert("提示：此问卷没有添加题目，不能提交！");return;}f.sort(function(r,e){return r._topic-e._topic;});var p="";for(i=0;i<f.length;i++){if(i>0){p+=spChars[1];}p+=f[i]._topic;p+=spChars[0];p+=f[i]._value;}var j=$("#form1").attr("action");if(j.indexOf("aliyun.sojump.com")>-1||j.indexOf("temp.sojump.com")>-1){j=j.replace("aliyun.sojump.com",window.location.host).replace("temp.sojump.com",window.location.host);}var g=j+"&starttime="+encodeURIComponent($("#starttime").val());if(window.sojumpParm){g+="&sojumpparm="+encodeURIComponent(window.sojumpParm);}if(window.tparam){g+="&tparam=1&sojumpparmext="+encodeURIComponent(window.sojumpparmext);}if(window.Password){g+="&psd="+encodeURIComponent(Password);}if(window.hasMaxtime){g+="&hmt=1";}if(window.initMaxSurveyTime){g+="&mst="+window.initMaxSurveyTime;}if(tCode&&tCode.style.display!="none"&&submit_text.value!=""){g+="&validate_text="+encodeURIComponent(submit_text.value);}if(window.isDianChu){g+="&check_key="+encodeURIComponent(check_key)+"&check_address="+encodeURIComponent(check_address)+"&validate_text=dian";}if(window.cpid){g+="&cpid="+cpid;}if(window.guid){g+="&emailguid="+guid;}if(window.udsid){g+="&udsid="+window.udsid;}if(nvvv){g+="&nvvv=1";}if(window.sjUser){g+="&sjUser="+encodeURIComponent(sjUser);}if(window.sourceurl){g+="&source="+encodeURIComponent(sourceurl);}else{g+="&source=directphone";}var n=window.alipayAccount||window.cAlipayAccount;if(n){g+="&alac="+encodeURIComponent(n);}if(window.SJBack){g+="&sjback=1";}if(window.jiFen&&jiFen>0){g+="&jf="+jiFen;}if(l){g+="&submittype="+l;}if(l==3){g+="&zbp="+(cur_page+1);if(needSubmitNotValid){g+="&nsnv=1";}}if(window.rndnum){g+="&rn="+encodeURIComponent(rndnum);}if(imgVerify){g+="&btuserinput="+encodeURIComponent(submit_text.value);g+="&btcaptchaId="+encodeURIComponent(imgVerify.captchaId);g+="&btinstanceId="+encodeURIComponent(imgVerify.instanceId);}if(window.inviteid){g+="&inviteid="+encodeURIComponent(inviteid);}if(window.access_token){g+="&access_token="+encodeURIComponent(access_token)+"&openid="+encodeURIComponent(openid);}if(window.wxthird){g+="&wxthird=1";}if(window.isWeiXin){g+="&iwx=1";}g+="&t="+new Date().valueOf();if(window.cProvince){g+="&cp="+encodeURIComponent(cProvince.replace("'",""))+"&cc="+encodeURIComponent(cCity.replace("'",""))+"&ci="+escape(cIp);var c=cProvince+","+cCity;var o=window.location.host||"sojump.com";try{setCookie("ip_"+cIp,c,null,"/","",null);}catch(d){}}$("#ctlNext").hide();var q="处理中......";if(langVer==1){q="Submiting......";}$(".ValError").html(q);if(l==3){$(".ValError").html("正在验证，请稍候...");}var m={submitdata:p};var h=false;var b=window.getMaxWidth||1800;var a=encodeURIComponent(p);if(window.submitWithGet&&a.length<=b){h=true;}if(h){g+="&submitdata="+a;g+="&useget=1";}else{if(window.submitWithGet){window.postIframe=1;}}if(window.postIframe){postWithIframe(g,p);}else{if(h){$.ajax({type:"GET",url:g,success:function(e){afterSubmit(e,l);},error:function(){$(".ValError").html("很抱歉，网络连接异常，请重新尝试提交！");$("#ctlNext").show();return;}});}else{$.ajax({type:"POST",url:g,data:m,dataType:"text",success:function(e){afterSubmit(e,l);}});}}}function postWithIframe(b,c){var a=document.createElement("div");a.style.display="none";a.innerHTML="<iframe id='mainframe' name='mainframe' style='display:none;' > </iframe><form target='mainframe' data-ajax='false' id='frameform' action='' method='post' enctype='application/x-www-form-urlencoded'><input  value='' id='submitdata' name='submitdata' type='hidden'><input type='submit' value='提交' ></form>";document.body.appendChild(a);document.getElementById("submitdata").value=c;var d=document.getElementById("frameform");d.action=b+"&iframe=1";d.submit();}var havereturn=false;var timeoutTimer=null;function processError(c,b,a){if(!havereturn){havereturn=true;$(".ValError").html("提交超时，请检查网络是否异常！");$("#ctlNext").show();}if(timeoutTimer){clearTimeout(timeoutTimer);}}var nvvv=0;function afterSubmit(t,l){$(".ValError").html("");havereturn=true;var n=t.split("〒");var h=n[0];if(h==10){var g=n[1];var o=g.replace("complete.aspx","completemobile2.aspx").replace("?q=","?activity=").replace("&joinid=","&joinactivity=").replace("&JoinID=","&joinactivity=");if(startAge){o+="&sa="+encodeURIComponent(startAge);}if(endAge){o+="&ea="+encodeURIComponent(endAge);}if(rName){o+="&rname="+encodeURIComponent(rName);}if(inviteid){o+="&inviteid="+encodeURIComponent(inviteid);}if(window.sourceurl){o+="&source="+encodeURIComponent(sourceurl);}if(window.sjUser){o+="&sjUser="+encodeURIComponent(sjUser);}if(window.needHideShare){o+="&nhs=1";}if(window.isSimple){o+="&s=t";}if(!window.wxthird&&window.access_token&&window.hashb){o+="&access_token="+encodeURIComponent(access_token)+"&openid="+encodeURIComponent(openid);}if(window.isWeiXin){var q=new Date();q.setTime(q.getTime()+(30*60*1000));setCookie("join_"+activityId,"1",q.toUTCString(),"/","",null);}if($("#shopcart")[0]&&$("#shopcart")[0].style.display!="none"){o+="&ishop=1";}location.replace(o);return;}else{if(h==11){var m=n[1];if(!m){m=window.location.href;}else{if(m.toLowerCase().indexOf("http://")==-1&&m.toLowerCase().indexOf("https://")==-1){m="http://"+m;}}var v=n[3]||"";var k=n[4]||"";var s=false;if(m.indexOf("{output}")>-1){if(window.sojumpParm){m=m.replace("{output}",window.sojumpParm);}else{if(k){m=m.replace("{output}",k);}}s=true;}if(window.sojumpParm||k){var j=v.split(",");var a="sojumpindex="+j[0];if(m.indexOf("?")>-1){a="&"+a;}else{a="?"+a;}if(j[1]){a+="&totalvalue="+j[1];}if(m.toLowerCase().indexOf("sojumpparm=")==-1&&!s&&window.sojumpParm){a+="&sojumpparm="+window.sojumpParm;}if(m.toLowerCase().indexOf("pingzheng=")==-1&&!s&&k){a+="&pingzheng="+k;}m+=a;}if(window.wxthird&&window.openid){if(m.indexOf("?")>-1){m+="&openid="+encodeURIComponent(openid);}else{m+="?openid="+encodeURIComponent(openid);}}if(m.indexOf("www.sojump.com")>-1){m=m.replace("/jq/","/m/");}var r=n[2];var f=1000;if(r&&window.jiFenBao==0&&r!="不提示"&&!window.sojumpParm){$(".ValError").html(r);f=2000;}setTimeout(function(){location.replace(m);},f);return;}else{if(l==3){if(h==12){to_next_page();$("#ctlNext").show();return;}else{if(h==13){var d=n[1];var u=n[2]||"0";var g="/wjx/join/completemobile2.aspx?activity="+activityId+"&joinactivity="+d;g+="&v="+u;if(window.isWeiXin){setCookie("join_"+activityId,"1",null,"/","",null);}if(window.sjUser){g+="&sjUser="+encodeURIComponent(sjUser);}if(window.sourceurl){g+="&source="+encodeURIComponent(sourceurl);}location.replace(g);return;}else{if(h==11){return;}else{if(h==5){alert(n[1]);return;}}}}}else{if(h==9||h==16||h==23){var p=parseInt(n[1]);var c=(p+1)+"";var e=n[2]||"您提交的数据有误，请检查！";if(questionsObject[c]){writeError(questionsObject[c],e,3000);$(questionsObject[c])[0].scrollIntoView();}alert(e);$("#ctlNext").show();}else{if(h==2||h==21){alert(n[1]);window.submitWithGet=1;$("#ctlNext").show();}else{if(h==4){alert(n[1]);$("#ctlNext").show();return;}else{if(h==19||h==5){alert(n[1]);$("#ctlNext").show();return;}else{if(h==17){alert("密码已经被其他人使用过！");return;}else{if(h==22){alert("提交有误，请输入验证码重新提交！");if(!needAvoidCrack){tCode.style.display="";imgCode.style.display="";imgCode.onclick=refresh_validate;imgCode.onclick();}nvvv=1;$("#ctlNext").show();return;}else{if(h==7){alert(n[1]);if(!needAvoidCrack){tCode.style.display="";if(!imgCode.onclick){imgCode.style.display="";imgCode.onclick=refresh_validate;}imgCode.onclick();}else{refresh_validate();}$("#ctlNext").show();return;}else{var b=n[1]||t;alert(b);$("#ctlNext").show();}}}}}}}}}}refresh_validate();}function clearFieldValue(c){var d=$(c).attr("type");if(d=="3"){$("input[type='radio']:checked",$(c)).each(function(){this.checked=false;$(this).parent().parent().find("a.jqradio").removeClass("jqchecked");});$("input.OtherRadioText",$(c)).each(function(){$(this).val("").blur();});}else{if(d=="4"){$("input:checked",$(c)).each(function(){this.checked=false;$(this).parent().parent().find("a.jqcheck").removeClass("jqchecked");});}else{if(d=="6"||d=="5"){$("a.rate-off",$(c)).each(function(){$(this).removeClass("rate-on");var a=$(this).attr("mode");if(a){$(this).removeClass("rate-on"+a);}else{$(this).removeClass("rate-ontxt");}});}else{if(d=="7"){if($("select",$(c)).val()!="-2"){$("select",$(c)).val("-2").trigger("change");}}else{if(d=="8"){$("input",$(c)).val("").change();}else{if(d=="9"){$("input.ui-slider-input",$(c)).each(function(){$(this).val("").change();});}else{if(d=="11"){$("li.ui-li-static",$(c)).each(function(){$(this).find("span.sortnum").html("").removeClass("sortnum-sel");$(this).attr("check","");});}}}}}}}}function validateQ(o){var g=$(o).attr("req"),l=$(o).attr("type"),n=true;var k=$(o)[0];var f="";var e=$(o).attr("hasjump");if(l=="1"){var h=$("input",$(o));var d=$.trim(h.val());n=d.length==0?false:true;f=verifyTxt(o,h);}else{if(l=="2"){var h=$("textarea",$(o));var d=$.trim(h.val());n=d.length==0?false:true;f=verifyTxt(o,h);}else{if(l=="3"){n=false;$(o).find("input:checked").each(function(){n=true;if(this.getAttribute("jumpto")==-1){needSubmitNotValid=true;}var a=$(this).attr("rel");if(a){var b=$("#"+a);if(b.attr("required")&&b.val().length==0){f="文本框内容必须填写！";writeError(o,f,3000);return false;}}});}else{if(l=="4"){n=false;var p=false;$(o).find("input:checked").each(function(){n=true;var a=$(this).attr("rel");if(a){var b=$("#"+a);if(b.attr("required")&&b.val().length==0){f="文本框内容必须填写！";b.focus();writeError(o,f,3000);p=true;return false;}}});if(!p){f=verifyCheckMinMax($(o),true);}}else{if(l=="11"){n=$("li.ui-li-static[check='1']",$(o)).length==0?false:true;f=verifyCheckMinMax($(o),true,true);}else{if(l=="5"){n=validateScaleRating($(o));}else{if(l=="6"){f=validateMatrix($(o),g);if(f){writeError(o,f,1000);return false;}}else{if(l=="7"){var j=$("select",$(o))[0];n=j.selectedIndex==0?false:true;if(n){if(j.options[j.selectedIndex]&&j.options[j.selectedIndex].getAttribute("jumpto")==-1){needSubmitNotValid=true;}}}else{if(l=="8"){n=$("input",$(o)).val().length==0?false:true;}else{if(l=="9"){$("input",$(o)).each(function(){var a=$(this);var c=$.trim(a.val());if(window.hasReferClient){var b=this.parentNode.parentNode.parentNode;if(b&&b.style.display=="none"){return true;}}if(c.length==0){n=false;if(a.attr("isrequir")=="0"){n=true;}else{return false;}}f=verifyTxt(o,a,true);if(f){return false;}});}else{if(l=="12"){var m=$(o).attr("total");var q=m;$("input",$(o)).each(function(){var a=$(this);if(window.hasReferClient){var c=this.parentNode.parentNode.parentNode;if(c&&c.style.display=="none"){return true;}}var b=a.val();if(b.length==0){n=false;}if(b){q=q-b;}});if(q!=0){writeError(o,"",3000);return false;}}else{if(l=="13"){if(!$(o)[0].fileName){n=false;}}else{if(l=="10"){var s="input";if($(o).attr("select")=="1"){s="select";}var r=true;$("table",$(o)).each(function(){var a=$(this);if(window.hasReferClient){var b=this.parentNode;if(b&&b.style.display=="none"){return true;}}$(s,a).each(function(){var t=$(this);var u=t.val();var c=this.parentNode.parentNode;if(c&&c.style.display!="none"){if(u.length==0||(s=="select"&&u=="-2")){n=false;o.errorControl=this;return false;}f=verifyTxt(o,t,true);if(f){o.errorControl=this;r=false;return false;}}});if(!r){return false;}});}}}}}}}}}}}}}if(!n&&g=="1"){f="此题是必答题";if(l=="6"&&$(o)[0].isMatrixFillError){f="请注明原因";}if(langVer==1){f="required";}writeError(o,f,1000);}else{$("span.error",$(o)).hide();$("div.field-label",$(o)).css("background","");}if(f){return false;}if(k.removeError){k.removeError();}return true;}function show_prev_page(){if(cur_page>0&&pageHolder[cur_page-1].hasExceedTime){alert("上一页填写超时，不能返回上一页");return;}var e=$("#divNext")[0];var h=$("#divPrev")[0];pageHolder[cur_page].style.display="none";e.style.display="";$("#divSubmit").hide();cur_page--;for(var c=cur_page;c>=0;c--){if(pageHolder[c].skipPage){cur_page--;}else{break;}}var g=window.isKaoShi;for(var c=cur_page;c>=0;c--){var a=pageHolder[c].questions;if(a.length==0&&!g){break;}var f=false;for(var b=0;b<a.length;b++){var d=a[b];if(d.style.display!="none"){f=true;break;}}if(!f&&cur_page>0){cur_page--;}else{break;}}if(cur_page==0){h.style.display="none";}pageHolder[cur_page].style.display="";pageHolder[cur_page].scrollIntoView();showProgress();}function show_next_page(){var a=$("#divNext a")[0];if(a&&a.disabled){return;}if(!validate()){return;}var b=$(pageHolder[cur_page]).attr("iszhenbie")=="true";if(needSubmitNotValid&&window.isRunning){$("#divNext").hide();groupAnswer(3);}else{if(b&&window.isRunning){$("#divNext").hide();groupAnswer(3);}else{to_next_page();}}}function to_next_page(){var m=$("#divNext")[0];var b=$("#divPrev")[0];b.style.display=displayPrevPage;pageHolder[cur_page].style.display="none";cur_page++;if(cur_page==1){$("#divDesc").hide();}for(var k=cur_page;k<pageHolder.length;k++){if(pageHolder[k].skipPage){cur_page++;}else{break;}}var o=false;var e=window.isKaoShi;for(var k=cur_page;k<pageHolder.length;k++){var n=pageHolder[k].questions;if(n.length==0&&!o&&!e){var c=$(".cutfield",pageHolder[k]);if(c.length>0){var d=false;for(var f=0;f<c.length;f++){if(c[f].style.display!="none"){d=true;break;}}if(!d&&cur_page<pageHolder.length-1){cur_page++;continue;}}break;}var h=false;for(var f=0;f<n.length;f++){var a=n[f];if(a.style.display!="none"){h=true;break;}}if(!h&&cur_page<pageHolder.length-1){cur_page++;o=true;}else{break;}}var g=true;for(var k=cur_page+1;k<pageHolder.length;k++){if(!pageHolder[k].skipPage){g=false;}}if(cur_page>=pageHolder.length-1||g){m.style.display="none";$("#divSubmit").show();}if(cur_page<pageHolder.length-1){m.style.display="";}pageHolder[cur_page].style.display="";initSlider();var l=document.getElementById("divMaxTime");if(l&&l.style.display==""){$("body,html").animate({scrollTop:0},100);}else{pageHolder[cur_page].scrollIntoView();}showProgress();if(window.hasPageTime){processMinMax();}fixBottom();}function initSlider(){if(window.hasSlider){$(pageHolder[cur_page].questions).each(function(){var b=$(this);var a=b.attr("type");if(a=="8"||a=="12"||a=="9"||a=="10"){setTimeout(function(){var c=$("input.ui-slider-input:visible",b);c.rangeslider({polyfill:false});},10);}});}}function initqSlider(a){if(!window.hasSlider){return;}if(a.hasInitSlider){return;}a.hasInitSlider=true;var b=$("input.ui-slider-input:visible",a);b.rangeslider({polyfill:false});}function showProgress(){if(totalPage==1){return;}var c=cur_page+1;if(c>totalPage){c=totalPage;}var b=c+"/"+totalPage;$(".pagepercent").html(b+"页");var a=c*100/totalPage;$(".pagebar").width(a+"%");}function verifyCheckMinMax(a,c,k,e){var d=a.attr("minvalue");var h=a.attr("maxvalue");var g=a[0];if(d==0&&h==0){return"";}var f=0;if(k){f=$("li.ui-li-static[check='1']",a).length;}else{f=$("input:checked",a).length;}if(f==0&&!a.attr("req")){return;}var b="";if(langVer==0){b="&nbsp;&nbsp;&nbsp;您已经选择了"+f+"项";}var j=true;if(h>0&&f>h){if(e){if(langVer==0){alert("此题最多只能选择"+h+"项");}$(e).trigger("click");return"";}if(langVer==0){b+=",<span style='color:red;'>多选择了"+(f-h)+"项</span>";}else{b=validate_info+validate_info_check4+h+type_check_limit5;}j=false;}else{if(d>0&&f<d){if(langVer==0){b+=",<span style='color:red;'>少选择了"+(d-f)+"项</span>";}else{b=validate_info+validate_info_check5+d+type_check_limit5;}j=false;if(!k&&f==1&&$("input:checked",a).parent().parent().hasClass("huchi")){j=true;}}}if(!g.errorMessage){g.errorMessage=$(".errorMessage",a)[0];}if(!j){if(!c){g.errorMessage.innerHTML=b;}else{writeError(a[0],b,3000);}return b;}else{g.errorMessage.innerHTML="";}return"";}function checkOnly(c,e){var d=$(e).attr("needonly");if(!d){return;}if($(e).attr("verify")=="地图"){return;}var g=$(e).val();if(!g){return;}if(g.length>50){return;}var b="/Handler/AnswerOnlyHandler.ashx?q="+activityId+"&at="+g+"&qI="+getTopic(c)+"&o=true&t="+(new Date()).valueOf();var a=$(c)[0];var f="";if(!e.errorOnly){e.errorOnly=new Object();}if(e.errorOnly[g]){f=validate_only;if(a.verifycodeinput){a.verifycodeinput.parentNode.style.display="none";}writeError(a,f,3000);return;}$.ajax({type:"GET",url:b,async:false,success:function(h){if(h=="false1"){f=validate_only;e.errorOnly[g]=1;if(a.verifycodeinput){a.verifycodeinput.parentNode.style.display="none";}writeError(a,f,3000);}}});}function verifyTxt(a,e,d){var c=$(e).val();var h=$(e).attr("verify");var j=$(e).attr("minword");var f=$(e).attr("maxword");var g=$(a)[0];var b="";if(!c){return b;}if(g.removeError){g.removeError();}b=verifyMinMax(c,h,j,f);if(!b){b=verifydata(c,h);}if(b){if(!g.errorControl&&d){g.errorControl=$(e)[0];}writeError(g,b,3000);return b;}if(!b&&g.needsms&&!g.issmsvalid){b="提示：您的手机号码没有通过验证，请先验证";writeError(g,b,3000);}return b;}function validateMatrix(s,h){var j=$("table.matrix-rating",$(s)),t;var g="";$(s)[0].isMatrixFillError=false;var k=j[0].rows;for(var o=0;o<k.length;o++){var b=k[o];var f=b.getAttribute("tp");if(f!="d"){continue;}if(window.hasReferClient&&b.style.display=="none"){continue;}var p=$(b).attr("fid"),r=$("a.rate-on",$(b));t="";if(r.length==0){if(h=="1"){g="此题是必答题";if(langVer==1){g="required";}$(s)[0].errorControl=$(b).prev("tr")[0];break;}else{continue;}}else{t=$(r[r.length-1]).attr("dval");var x=$(s).attr("ischeck");if(x){t="";var l=$(s).attr("minvalue");var n=$(s).attr("maxvalue");if(l&&r.length-l<0){g=validate_info+validate_info_check5+l+type_check_limit5;$(s)[0].errorControl=$(b).prev("tr")[0];break;}else{if(n&&r.length-n>0){g=validate_info+validate_info_check4+n+type_check_limit5;$(s)[0].errorControl=$(b).prev("tr")[0];break;}}var v=true;$(r).each(function(){if(t){t+=";";}t+=$(this).attr("dval");var c=$(this).attr("needfill");if(c){var d=this.fillvalue||"";d=replace_specialChar(d).replace(/;/g,"；").replace(/,/g,"，");t+=spChars[2]+d;var a=$(this).attr("req");if(a&&!d){g="此题是必答题";if(langVer==1){g="required";}$(s)[0].isMatrixFillError=true;showMatrixFill(this,1);v=false;return false;}}});if(!v){break;}}else{var w=$(r[r.length-1]).attr("mode");if(!w){var m=$(r[r.length-1]).attr("needfill");if(m){var q=r[r.length-1].fillvalue||"";q=replace_specialChar(q).replace(/;/g,"；").replace(/,/g,"，");t+=spChars[2]+q;var u=$(r[r.length-1]).attr("req");if(u&&!q){g="此题是必答题";if(langVer==1){g="required";}$(s)[0].isMatrixFillError=true;showMatrixFill(r[r.length-1],1);break;}}}}$("#"+p,$(s)).attr("value",t);}}return g;}function validateScaleRating(d){var e=true,f=$("table.scale-rating",$(d));var f=$("a.rate-on",f);if(f.length==0){e=false;}else{$("input:hidden",$(d)).attr("value",$(f[f.length-1]).attr("val"));if(f.attr("jumpto")==-1){needSubmitNotValid=true;}}return e;}function jump(c,e){var d=$(c);var b=d.attr("type");var f=d.attr("hasjump");var a=d.attr("anyjump");if(f){if(a>0){jumpAnyChoice(c);}else{if(a==0&&b!="3"&&b!="5"&&b!="7"){jumpAnyChoice(c);}else{jumpByChoice(c,e);}}}}function jumpAnyChoice(c,f){var d=$(c);var b=d.attr("type");var a=false;if(b=="1"){a=$("input",d).val().length>0;}else{if(b=="2"){a=$("textarea",d).val().length>0;}else{if(b=="3"){a=$("input[type='radio']:checked",d).length>0;}else{if(b=="4"){a=$("input[type='checkbox']:checked",d).length>0;}else{if(b=="5"){a=$("a.rate-on",d).length>0;}else{if(b=="6"){a=$("a.rate-on",d).length>0;}else{if(b=="7"){a=$("select",d).val()!=-2;}else{if(b=="8"){a=$("input",d).val().length>0;}else{if(b=="9"||b=="12"){$("input",d).each(function(){var g=$(this).val();if(g.length>0){a=true;}});}else{if(b=="10"){var e=d.attr("select")=="1";if(e){$("select",d).each(function(){var g=$(this).val();if(g!=-2){a=true;}});}else{$("input",d).each(function(){var g=$(this).val();if(g.length>0){a=true;}});}}else{if(b=="11"){a=$("li[check='1']",d).length>0;}else{if(b=="13"){a=d[0].fileName?true:false;}}}}}}}}}}}}jumpAny(a,c,f);}function jumpByChoice(d,e){var c=$(d).attr("type");var b=$(d)[0];if(e.value=="-2"){processJ(b.indexInPage-0,0);}else{if(e.value=="-1"||e.value==""){processJ(b.indexInPage-0,0);}else{if((c=="3"||c=="5"||c=="7")){var f=e.value||$(e).attr("val");if(parseInt(f)==f){var a=$(e).attr("jumpto")-0;processJ(b.indexInPage-0,a);}}}}}function jumpAny(c,e,g){var f=$(e);var d=f.attr("type");var h=f.attr("hasjump");var a=f.attr("anyjump")-0;var b=f[0];if(h){if(c){processJ(b.indexInPage-0,a,g);}else{processJ(b.indexInPage-0,0,g);}}}function processJ(n,d,e){var a=n+1;var b=cur_page;var f=d==1||d==-1;for(var k=cur_page;k<pageHolder.length;k++){var m=pageHolder[k].questions;if(f){b=k;}for(var h=a;h<m.length;h++){var l=getTopic(m[h]);if(l==d||f){b=k;}if(l<d||f){m[h].style.display="none";}else{if(relationNotDisplayQ[l]){var g=1;}else{m[h].style.display="";}var c=$(m[h]).attr("hasjump");if(c&&!e){clearFieldValue(m[h]);}}}a=0;}fixBottom();}function GetBacktoServer(){str=window.location.pathname;index=str.lastIndexOf("/");page=str.substr(index+1,str.length-index);data=readCookie("history");if(data!=null&&data.toLowerCase()!=page.toLowerCase()){window.location.href=window.location.href;}}function readCookie(h){for(var k=h+"=",j=document.cookie.split(";"),f=0;f<j.length;f++){var g=j[f];while(g.charAt(0)==" "){g=g.substring(1,g.length);}if(g.indexOf(k)==0){return g.substring(k.length,g.length);}}return null;}function removeError(){if(this.errorMessage){this.errorMessage.innerHTML="";this.removeError=null;this.style.border="solid 2px #f7f7f7";if(this.errorControl){this.errorControl.style.background="white";this.errorControl=null;}}}function writeError(a,c,b){a=$(a)[0];a.style.border="solid 2px #ff9900";if(a.errorMessage){a.errorMessage.innerHTML=c;}else{a.errorMessage=$(".errorMessage",$(a))[0];a.errorMessage.innerHTML=c;}a.removeError=removeError;if(a.errorControl){a.errorControl.style.background="#FBD5B5";}if(!firstError){firstError=a;}return false;}function verifydata(d,c){if(!c){return"";}var a=null;if(c.toLowerCase()=="email"||c.toLowerCase()=="msn"){a=/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i;if(!a.exec(d)){return validate_email;}else{return"";}}else{if(c=="日期"||c=="生日"||c=="入学时间"){return"";}else{if(c=="固话"){a=/^((\d{4}-\d{7})|(\d{3,4}-\d{8}))(-\d{1,4})?$/;if(!a.exec(d)){return validate_phone.replace("，请注意使用英文字符格式","");}else{return"";}}else{if(c=="手机"){a=/^\d{11}$/;if(!a.exec(d)){return validate_mobile.replace("，请注意使用英文字符格式","");}else{return"";}}else{if(c=="电话"){a=/(^\d{11}$)|(^((\d{4}-\d{7})|(\d{3,4}-\d{8}))(-\d{1,4})?$)/;if(!a.exec(d)){return validate_mo_phone.replace("，请注意使用英文字符格式","");}else{return"";}}else{if(c=="汉字"){a=/^[\u4e00-\u9fa5]+$/;if(!a.exec(d)){return validate_chinese;}else{return"";}}else{if(c=="姓名"){a=/^[\u4e00-\u9fa5]{2,4}$/;if(!a.exec(d)){return"姓名必须为2到4个汉字";}else{return"";}}else{if(c=="英文"){a=/^[A-Za-z]+$/;if(!a.exec(d)){return validate_english;}else{return"";}}else{if(c=="网址"||c=="公司网址"){a=/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;if(!a.exec(d)){return validate_reticulation;}else{return"";}}else{if(c=="身份证号"){a=/^\d{15}(\d{2}[A-Za-z0-9])?$/;if(!a.exec(d)){return validate_idcardNum;}else{return"";}}else{if(c=="学号"){a=/^\d+$/;if(!a.exec(d)){return validate_num.replace("，请注意使用英文字符格式","");}}else{if(c=="数字"){a=/^(\-)?\d+$/;if(!a.exec(d)){return validate_num.replace("，请注意使用英文字符格式","");}}else{if(c=="小数"){a=/^(\-)?\d+(\.\d+)?$/;if(!a.exec(d)){return validate_decnum;}}else{if(c.toLowerCase()=="qq"){a=/^\d+$/;var b=/^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$/;if(!a.exec(d)&&!b.exec(d)){return validate_qq;}else{return"";}}}}}}}}}}}}}}}return"";}function verifyMinMax(e,d,c,a){if(d=="数字"||d=="小数"){var b=/^(\-)?\d+$/;if(d=="小数"){b=/^(\-)?\d+(\.\d+)?$/;}if(!b.exec(e)){if(d=="小数"){return validate_decnum;}else{return validate_num.replace("，请注意使用英文字符格式","");}}if(e!=0){e=e.replace(/^0+/,"");}if(c!=""){if(d=="数字"&&parseInt(e)-parseInt(c)<0){return validate_num2+c;}else{if(d=="小数"&&parseFloat(e)-parseFloat(c)<0){return validate_num2+c;}}}if(a!=""){if(d=="数字"&&parseInt(e)-parseInt(a)>0){return validate_num1+a;}else{if(d=="小数"&&parseFloat(e)-parseFloat(a)>0){return validate_num1+a;}}}}else{if(a!=""&&e.length-a>0){return validate_info_wd3.format(a,e.length);}if(c!=""&&e.length-c<0){return validate_info_wd4.format(c,e.length);}}return"";}function getTopic(a){return $(a).attr("topic");}function relationJoin(b){if(b.style.display!="none"){var c=$(b);var a=c.attr("type");if(a=="3"){if($("input:checked",c).length>0){displayRelationByType(c,"input[type=radio]",1);}}else{if(a=="4"){if($("input:checked",c).length>0){displayRelationByType(c,"input[type=checkbox]",2);}}else{if(a=="7"){if($("select",c)[0].selectedIndex>0){displayRelationByType(c,"option",5);}}}}}}function displayRelationByType(e,d,c){var b=getTopic(e);if(!relationQs[b]){return;}e.hasDisplayByRelation=new Object();var a=-1;if(c==4){var f=$("a.rate-on",e);if(f[0]&&$(f[0]).attr("mode")){a=f.length-1;}}$(d,e).each(function(h){var j=false;var k="";if(c==1||c==2||c==5){k=this.value;}else{if(c==3){k=$("input[type=hidden]",this).val();}else{if(c==4){k=$(this).attr("val");}}}var l=b+","+k;if(c==3&&$(this).attr("check")){j=true;}else{if(c==4){if(a==-1&&$(this).hasClass("rate-on")){j=true;}else{if(h==a){j=true;}}}else{if((c==1||c==2)&&this.checked){j=true;}else{if(c==5&&this.selected){j=true;}}}}displayByRelation(e,l,j);var g=b+",-"+k;if(relationHT[g]){displayByRelationNotSelect(e,g,j);}});fixBottom();}function displayByRelation(c,f,b){var d=relationHT[f];if(!d){return;}for(var a=0;a<d.length;a++){var e=getTopic(d[a]);if(c.hasDisplayByRelation[e]){continue;}if(!b&&d[a].style.display!="none"){loopHideRelation(d[a]);}else{if(b){d[a].style.display="";initqSlider(d[a]);c.hasDisplayByRelation[e]="1";if(relationNotDisplayQ[e]){relationNotDisplayQ[e]="";}}}}}function displayByRelationNotSelect(c,f,b){var d=relationHT[f];if(!d){return;}for(var a=0;a<d.length;a++){var e=getTopic(d[a]);if(c.hasDisplayByRelation[e]){continue;}if(b&&d[a].style.display!="none"){loopHideRelation(d[a]);}else{if(!b){d[a].style.display="";initqSlider(d[a]);c.hasDisplayByRelation[e]="1";if(relationNotDisplayQ[e]){relationNotDisplayQ[e]="";}}}}}function loopHideRelation(a){var c=getTopic(a);var b=relationQs[c];if(b){for(var d=0;d<b.length;d++){loopHideRelation(b[d],false);}}clearFieldValue(a);$(a)[0].style.display="none";if(relationNotDisplayQ[c]==""){relationNotDisplayQ[c]="1";}}function checkHuChi(c,e){var b=$(".huchi",c)[0];if(!b){return;}var f=$(e);if(!$("input:checked",f)[0]){return;}var a=$(".ui-checkbox",c);var d=f.hasClass("huchi");a.each(function(){if(this==e){return true;}var g=$(this);if(!$("input:checked",g)[0]){return true;}if(d){g.trigger("click");}else{var h=g.hasClass("huchi");if(h){g.trigger("click");}}});}